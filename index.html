<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flappy — HTML/CSS/JS</title>
  <style>
    :root{
      --bg:#70c5ce; /* sky */
      --ground:#DEB887;
      --ui-bg: rgba(255,255,255,0.85);
      --accent:#ffcc00;
      --text:#1b1b1b;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;padding:0}
    html,body,#app{height:100%}
    body{background:linear-gradient(#9be7f0,var(--bg));display:flex;align-items:center;justify-content:center;padding:16px;color:var(--text)}
    #app{width:100%;max-width:1100px;display:grid;grid-template-columns:1fr 320px;gap:20px}
    @media (max-width:900px){#app{grid-template-columns:1fr;max-width:900px}}

    .game-wrap{background:linear-gradient(#c3f2ff,#70c5ce);border-radius:12px;box-shadow:0 8px 30px rgba(10,20,30,0.12);overflow:hidden;position:relative}
    canvas{display:block;width:100%;height:100%;background:transparent}
    /* UI panel */
    .panel{background:var(--ui-bg);padding:16px;border-radius:12px;height:100%;display:flex;flex-direction:column;gap:12px}
    .panel h2{font-size:18px}
    .row{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .btn.secondary{background:#e6e6e6}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    label{font-size:13px}

    /* Start overlay */
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:auto}
    .start-card{background:rgba(255,255,255,0.95);padding:18px;border-radius:12px;min-width:260px;max-width:420px;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
    .start-card h1{font-size:22px;margin-bottom:6px}
    .meta{font-size:14px;color:#333;margin-bottom:12px}
    .settings{display:flex;flex-direction:column;gap:8px;text-align:left;margin-bottom:12px}
    .setting-row{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .slider{width:100%}

    /* HUD */
    .hud{position:absolute;left:12px;top:12px;background:rgba(255,255,255,0.85);padding:8px 10px;border-radius:8px;font-weight:700}
    .score{position:absolute;right:12px;top:12px;background:rgba(255,255,255,0.9);padding:8px 10px;border-radius:8px;font-weight:700}

    /* footer small */
    .small{font-size:13px;color:#333}

    /* make sizes responsive */
    .game-wrap{aspect-ratio:3/5;min-height:360px}
    @media (min-width:900px){.game-wrap{aspect-ratio:16/9;min-height:420px}}
  </style>
</head>
<body>
  <div id="app">
    <div class="game-wrap" id="gameWrap">
      <canvas id="game"></canvas>
      <div class="hud" id="hud">High: --</div>
      <div class="score" id="scoredisp">0</div>
      <div class="overlay" id="overlay">
        <div class="start-card" id="startCard">
          <h1>Flappy — Web</h1>
          <div class="meta">Responsive Flappy bird clone. Tap / Click / Space to flap.</div>

          <div class="settings">
            <div class="setting-row">
              <label for="difficulty">Difficulty</label>
              <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="normal" selected>Normal</option>
                <option value="hard">Hard</option>
              </select>
            </div>
            <div class="setting-row">
              <label for="gapRange">Pipe gap</label>
              <input id="gapRange" class="slider" type="range" min="100" max="260" value="140">
            </div>
            <div class="setting-row">
              <label for="speedRange">Pipe speed</label>
              <input id="speedRange" class="slider" type="range" min="1" max="6" step="0.1" value="2.4">
            </div>
            <div class="setting-row">
              <label for="gravityRange">Gravity</label>
              <input id="gravityRange" class="slider" type="range" min="0.2" max="1.6" step="0.05" value="0.65">
            </div>
          </div>

          <div style="display:flex;gap:8px;justify-content:center">
            <button class="btn" id="startBtn">Start Game</button>
            <button class="btn secondary" id="demoBtn">Demo</button>
          </div>

          <div style="margin-top:12px" class="small">Best score: <strong id="uiHigh">0</strong></div>
        </div>
      </div>
    </div>

    <div class="panel">
      <h2>Controls & Settings</h2>
      <div class="row small">Tap / Click / Space to flap. On mobile tap the game area.</div>

      <div class="row"><strong>High Score:</strong><div style="margin-left:auto;font-weight:800" id="sideHigh">0</div></div>
      <div class="row"><strong>Current:</strong><div style="margin-left:auto;font-weight:800" id="sideScore">0</div></div>

      <div style="margin-top:8px">
        <div class="row controls">
          <button class="btn" id="playPause">Play / Pause</button>
          <button class="btn secondary" id="restart">Restart</button>
          <button class="btn secondary" id="openSettings">Open Start UI</button>
        </div>
      </div>

      <hr />
      <h3 style="margin-top:6px">Quick Presets</h3>
      <div class="row controls">
        <button class="btn" data-preset="easy">Easy</button>
        <button class="btn" data-preset="normal">Normal</button>
        <button class="btn" data-preset="hard">Hard</button>
      </div>

      <div style="flex:1" />
      <div class="small">Made with ♥ — High score stored locally in your browser.</div>
    </div>
  </div>

  <script>
    // Responsive Flappy Bird (single-file). No external assets.
    (() => {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');
      const wrap = document.getElementById('gameWrap');
      const overlay = document.getElementById('overlay');
      const startBtn = document.getElementById('startBtn');
      const demoBtn = document.getElementById('demoBtn');
      const difficulty = document.getElementById('difficulty');
      const gapRange = document.getElementById('gapRange');
      const speedRange = document.getElementById('speedRange');
      const gravityRange = document.getElementById('gravityRange');
      const hud = document.getElementById('hud');
      const scoredisp = document.getElementById('scoredisp');
      const uiHigh = document.getElementById('uiHigh');
      const sideHigh = document.getElementById('sideHigh');
      const sideScore = document.getElementById('sideScore');
      const playPause = document.getElementById('playPause');
      const restart = document.getElementById('restart');
      const openSettings = document.getElementById('openSettings');

      // device pixel handling
      function resize() {
        const ratio = window.devicePixelRatio || 1;
        const rect = wrap.getBoundingClientRect();
        // choose canvas size based on container
        canvas.width = Math.max(320, Math.floor(rect.width * ratio));
        canvas.height = Math.max(480, Math.floor(rect.height * ratio));
        ctx.setTransform(ratio,0,0,ratio,0,0);
      }
      window.addEventListener('resize', resize);
      resize();

      // local storage highscore
      const HS_KEY = 'flappy_highscore_v1';
      let highScore = parseInt(localStorage.getItem(HS_KEY) || '0',10) || 0;
      function saveHigh(){ localStorage.setItem(HS_KEY, String(highScore)); }
      uiHigh.textContent = highScore;
      sideHigh.textContent = highScore;
      hud.textContent = 'High: ' + highScore;

      // Game state
      let state = 'menu'; // menu, running, paused, over
      let pipes = [];
      let frame = 0;
      let score = 0;
      let bird = null;
      let gravity = parseFloat(gravityRange.value);
      let pipeSpeed = parseFloat(speedRange.value);
      let pipeGap = parseInt(gapRange.value,10);
      let autoDemo = false;

      // presets
      const PRESETS = {
        easy: {gravity:0.5, pipeSpeed:1.6, pipeGap:180},
        normal:{gravity:0.65, pipeSpeed:2.4, pipeGap:140},
        hard:{gravity:0.9, pipeSpeed:3.2, pipeGap:120}
      };

      function applyPreset(name){
        const p = PRESETS[name];
        if(!p) return;
        gravityRange.value = p.gravity; gravity = p.gravity;
        speedRange.value = p.pipeSpeed; pipeSpeed = p.pipeSpeed;
        gapRange.value = p.pipeGap; pipeGap = p.pipeGap;
        difficulty.value = name;
      }
      document.querySelectorAll('[data-preset]').forEach(b=>{
        b.addEventListener('click', ()=>applyPreset(b.dataset.preset));
      });

      function rand(min,max){return Math.random()*(max-min)+min}

      // bird model
      function createBird(){
        return {x:80, y:canvas.height/2, vy:0, radius:14, rotation:0, alive:true};
      }

      function resetGame(){
        pipes = [];
        frame = 0;
        score = 0;
        bird = createBird();
        scoredisp.textContent = '0';
        sideScore.textContent = '0';
      }

      function startGame(demo=false){
        autoDemo = !!demo;
        resetGame();
        state = 'running';
        overlay.style.pointerEvents = 'none';
        overlay.style.display = 'none';
      }

      function endGame(){
        state = 'over';
        bird.alive = false;
        overlay.style.display = 'flex';
        overlay.style.pointerEvents = 'auto';
        document.getElementById('startCard').querySelector('.meta').textContent = 'Game Over — Your score: '+score;
        document.getElementById('uiHigh').textContent = highScore;
        hud.textContent = 'High: ' + highScore;
      }

      // Controls
      function flap(){ if(state==='menu'){ startGame(); return } if(state==='over') return; bird.vy = -7.8; }
      window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); flap(); } if(e.code==='KeyP'){ togglePause(); } });
      canvas.addEventListener('click', ()=>flap());
      canvas.addEventListener('touchstart', (e)=>{ e.preventDefault(); flap(); }, {passive:false});

      startBtn.addEventListener('click', ()=>{
        // read settings
        gravity = parseFloat(gravityRange.value);
        pipeSpeed = parseFloat(speedRange.value);
        pipeGap = parseInt(gapRange.value,10);
        startGame(false);
      });
      demoBtn.addEventListener('click', ()=>{
        gravity = parseFloat(gravityRange.value);
        pipeSpeed = parseFloat(speedRange.value);
        pipeGap = parseInt(gapRange.value,10);
        startGame(true);
      });

      // quick UI buttons
      playPause.addEventListener('click', ()=>togglePause());
      restart.addEventListener('click', ()=>{ resetGame(); state='menu'; overlay.style.display='flex'; overlay.style.pointerEvents='auto'; document.getElementById('startCard').querySelector('.meta').textContent='Responsive Flappy bird clone. Tap / Click / Space to flap.' });
      openSettings.addEventListener('click', ()=>{ overlay.style.display='flex'; overlay.style.pointerEvents='auto'; state='menu'; });

      function togglePause(){ if(state==='running'){ state='paused'; overlay.style.display='flex'; overlay.style.pointerEvents='auto'; document.getElementById('startCard').querySelector('.meta').textContent='Paused'; } else if(state==='paused'){ state='running'; overlay.style.display='none'; overlay.style.pointerEvents='none'; } }

      // Settings live bindings
      [gapRange, speedRange, gravityRange].forEach(el=>el.addEventListener('input', ()=>{ pipeGap = parseInt(gapRange.value,10); pipeSpeed = parseFloat(speedRange.value); gravity = parseFloat(gravityRange.value); }));

      // Simple beep via WebAudio for flap/score
      const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      function beep(freq, time=0.05){ try{ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.setValueAtTime(0.001, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime+0.01); o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+time); o.stop(audioCtx.currentTime+time+0.02); }catch(e){} }

      // main loop
      function addPipe(){
        const topHeight = rand(40, canvas.height - pipeGap - 80);
        pipes.push({x: canvas.width + 40, top: topHeight, width:52});
      }

      function update(dt){
        if(state!=='running') return;
        frame++;
        // auto demo simple AI
        if(autoDemo){ if(bird.y > canvas.height/2){ flap(); } }

        // physics
        bird.vy += gravity; bird.y += bird.vy;
        bird.rotation = Math.max(Math.min(bird.vy/10,0.8), -0.8);

        // spawn pipes periodically
        if(frame % Math.max(40,Math.floor(110 - pipeSpeed*10)) === 0) addPipe();

        // move pipes
        for(let i=pipes.length-1;i>=0;i--){ const p=pipes[i]; p.x -= pipeSpeed; if(p.x + p.width < -30) pipes.splice(i,1); }

        // scoring: when bird passes pipe
        for(let i=0;i<pipes.length;i++){
          const p = pipes[i];
          if(!p.passed && p.x + p.width < bird.x - 6){ p.passed = true; score++; scoredisp.textContent = score; sideScore.textContent = score; beep(1200,0.02); if(score>highScore){ highScore = score; saveHigh(); uiHigh.textContent = highScore; sideHigh.textContent = highScore; hud.textContent = 'High: ' + highScore; } }
        }

        // collisions
        // ground
        const groundY = canvas.height - 28;
        if(bird.y + bird.radius > groundY){ bird.y = groundY - bird.radius; endGame(); return }
        if(bird.y - bird.radius < 0){ bird.y = bird.radius; bird.vy = 0 }

        // pipes collision
        for(const p of pipes){
          const pipeX = p.x; const w = p.width; const top = p.top; const gap = pipeGap;
          // rectangle collision approx
          const inX = bird.x + bird.radius > pipeX && bird.x - bird.radius < pipeX + w;
          if(inX){
            if(bird.y - bird.radius < top || bird.y + bird.radius > top + gap){
              endGame(); beep(200,0.2); return;
            }
          }
        }
      }

      function draw(){
        // clear
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const W = canvas.width; const H = canvas.height;

        // background gradient
        const g = ctx.createLinearGradient(0,0,0,H);
        g.addColorStop(0,'#a9e7ff'); g.addColorStop(1,'#70c5ce');
        ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

        // clouds (simple)
        for(let i=0;i<5;i++){
          const cx = (i*200 + (frame*0.2))% (W+200) - 100;
          ctx.globalAlpha = 0.25; ctx.fillStyle = '#fff'; drawCircle(ctx,cx, 60 + (i%2)*30, 26 + (i%3)*6);
        }
        ctx.globalAlpha = 1;

        // pipes
        for(const p of pipes){
          const x = p.x; const w = p.width; const top = p.top; const gap = pipeGap;
          // top
          ctx.fillStyle = '#2aa02a'; roundRect(ctx,x,0,w,top,6); ctx.fill();
          // bottom
          roundRect(ctx,x,top+gap,w,H - (top + gap) - 28,6); ctx.fill();
          // pipe rim
          ctx.fillStyle = '#1d7d1d'; roundRect(ctx,x-4,top-14,w+8,14,6); ctx.fill();
        }

        // ground
        ctx.fillStyle = 'rgba(210,180,140,0.98)'; ctx.fillRect(0,H-28,W,28);

        // bird
        drawBird(bird);

        // HUD drawn by DOM
      }

      function drawCircle(ctx,x,y,r){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
      function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

      function drawBird(b){
        if(!b) return;
        const x = b.x, y = b.y, r = b.radius;
        ctx.save(); ctx.translate(x,y); ctx.rotate(b.rotation);
        // body
        ctx.fillStyle = '#ffcc00'; drawCircle(ctx,0,0,r);
        // belly
        ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.ellipse(3,5,r*0.8,r*0.6,0,0,Math.PI*2); ctx.fill();
        // eye
        ctx.fillStyle = '#fff'; drawCircle(ctx,6 - r*0.2, -5, r*0.25);
        ctx.fillStyle = '#000'; drawCircle(ctx,6 - r*0.2, -5, r*0.11);
        // beak
        ctx.fillStyle = '#ff8a00'; ctx.beginPath(); ctx.moveTo(r*0.9,0); ctx.lineTo(r*1.9,-6); ctx.lineTo(r*1.9,6); ctx.closePath(); ctx.fill();
        ctx.restore();
      }

      // game loop timing
      let last = performance.now();
      function frameLoop(now){
        const dt = Math.min(50, now - last)/16.666;
        last = now;
        // live-resize if needed
        // update logical canvas resolution only if container changed significantly
        update(dt);
        draw();
        requestAnimationFrame(frameLoop);
      }
      requestAnimationFrame(frameLoop);

      // small UI updates
      setInterval(()=>{
        sideHigh.textContent = highScore; uiHigh.textContent = highScore; hud.textContent = 'High: ' + highScore;
      },1500);

      // store settings when difficulty select changes
      difficulty.addEventListener('change', ()=>applyPreset(difficulty.value));

      // initialize
      resetGame();

      // show highscore in overlay
      document.getElementById('uiHigh').textContent = highScore;

      // keyboard accessibility hint
      // Prevent the page from scrolling down when space is pressed in many browsers by preventing default above.

      // Touch & pointer visual focus
      canvas.style.touchAction = 'manipulation';

      // small tweak: ensure audio context is resumed on user gesture (some browsers require it)
      ['click','touchstart','keydown'].forEach(ev=>window.addEventListener(ev, ()=>{ if(audioCtx.state==='suspended') audioCtx.resume(); }, {once:false}));

    })();
  </script>
</body>
</html>
